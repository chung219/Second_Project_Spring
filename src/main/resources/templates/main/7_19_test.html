<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
</head>
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=3fa5806dfe291fb3622cf85fca14b017&libraries=services,clusterer,drawing"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<body>

<div class="container">
    <div class="py-5 text-center">
        <h2>메인테스트 화면</h2>
        <div id="map" style="width:700px;height:900px;"></div>
        <button onclick="setOverlayMapTypeId('traffic')">교통정보 보기</button>
        <button onclick="hideMarkers()">마커 감추기</button>
        <button onclick="showMarkers()">마커 보이기</button>
        <script th:inline="javascript">
            var mapContainer = document.getElementById('map'), // 지도를 표시할 div
                mapOption = {
                    center: new kakao.maps.LatLng(36.01683146793617, 129.42603381793853), // 지도의 중심좌표
                    level: 13 // 지도의 확대 레벨
                };
            // 지도를 생성합니다
            var map = new kakao.maps.Map(mapContainer, mapOption);

            // 지도에 추가된 지도타입정보를 가지고 있을 변수입니다
            var currentTypeId;

            // 버튼이 클릭되면 호출되는 함수입니다
            function setOverlayMapTypeId(maptype) {
                // 현재 지도 타입이 교통정보인지 확인합니다
                var isTrafficType = currentTypeId === kakao.maps.MapTypeId.TRAFFIC;

                if (maptype === 'traffic') {
                    // 현재 지도 타입이 교통정보이면 껐다 켭니다
                    if (isTrafficType) {
                        map.removeOverlayMapTypeId(kakao.maps.MapTypeId.TRAFFIC);
                        currentTypeId = null;
                    } else {
                        // 교통정보 지도타입을 추가합니다
                        map.addOverlayMapTypeId(kakao.maps.MapTypeId.TRAFFIC);
                        currentTypeId = kakao.maps.MapTypeId.TRAFFIC;
                    }
                }
            }

            // // 지도에 교통정보를 표시하도록 지도타입을 추가합니다
            // map.addOverlayMapTypeId(kakao.maps.MapTypeId.TRAFFIC);

            // 일반 지도와 스카이뷰로 지도 타입을 전환할 수 있는 지도타입 컨트롤을 생성합니다
            var mapTypeControl = new kakao.maps.MapTypeControl();

            // 지도에 컨트롤을 추가해야 지도위에 표시됩니다
            // kakao.maps.ControlPosition은 컨트롤이 표시될 위치를 정의하는데 TOPRIGHT는 오른쪽 위를 의미합니다
            map.addControl(mapTypeControl, kakao.maps.ControlPosition.TOPRIGHT);

            // 지도 확대 축소를 제어할 수 있는  줌 컨트롤을 생성합니다
            var zoomControl = new kakao.maps.ZoomControl();
            map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);

            // 주소-좌표 변환 객체를 생성합니다
            var geocoder = new kakao.maps.services.Geocoder();




            var add_list = [[${address}]];
            console.log(add_list)

            var markers = []



            add_list.forEach(function (address) {

                var first_address = address.add1
                var name = address.name

                // 주소로 좌표를 검색합니다
                geocoder.addressSearch(first_address, function (result, status) {

                    // 정상적으로 검색이 완료됐으면
                    if (status === kakao.maps.services.Status.OK) {

                        var coords = new kakao.maps.LatLng(result[0].y, result[0].x);

                        // 결과값으로 받은 위치를 마커로 표시합니다
                        var marker = new kakao.maps.Marker({
                            map: map,
                            position: coords,
                        });

                        markers.push(marker)

                        // 마커에 표시할 인포윈도우를 생성합니다
                        var infowindow = new kakao.maps.InfoWindow({
                            content: '<div style="padding:5px;">'+name+'</div>' // 인포윈도우에 표시할 내용
                        });

                        // 마커에 이벤트를 등록하는 함수 만들고 즉시 호출하여 클로저를 만듭니다
                        // 클로저를 만들어 주지 않으면 마지막 마커에만 이벤트가 등록됩니다
                        (function(marker, infowindow) {
                            // 마커에 mouseover 이벤트를 등록하고 마우스 오버 시 인포윈도우를 표시합니다
                            kakao.maps.event.addListener(marker, 'mouseover', function() {
                                infowindow.open(map, marker);
                            });

                            // 마커에 mouseout 이벤트를 등록하고 마우스 아웃 시 인포윈도우를 닫습니다
                            kakao.maps.event.addListener(marker, 'mouseout', function() {
                                infowindow.close();
                            });
                        })(marker, infowindow);

                    }
                });

            });
            // 배열에 추가된 마커들을 지도에 표시하거나 삭제하는 함수입니다
            function setMarkers(map) {
                for (var i = 0; i < markers.length; i++) {
                    markers[i].setMap(map);
                }
            }

            // "마커 보이기" 버튼을 클릭하면 호출되어 배열에 추가된 마커를 지도에 표시하는 함수입니다
            function showMarkers() {
                setMarkers(map)
            }

            // "마커 감추기" 버튼을 클릭하면 호출되어 배열에 추가된 마커를 지도에서 삭제하는 함수입니다
            function hideMarkers() {
                setMarkers(null);
            }
        </script>

    </div>
</body>
</html>