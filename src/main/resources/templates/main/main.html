<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="robots" content="ALL"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <title>전국 프랜차이즈 가맹현황</title>
    <meta name="Description" content="우리동네 외식업 프랜차이즈 가맹점 통계에 대한 다양한 정보를 제공합니다."/>
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=0.1,maximum-scale=5.0,user-scalable=yes" />
    <link rel="stylesheet" type="text/css" href="css/reset.css" >
    <link rel="stylesheet" type="text/css" href="css/layout.css" >
    <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css">
    <script src="js/jquery.js"></script>
    <!--    <script src="js/jquery-ui-1.10.4.custom.min.js"></script>-->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <!-- js chart 설치 -->
</head>
<body>
<div class="container">
    <!-- ####### 01. HEADER START ####### -->
    <div class="header_wrap" th:include="header.html"></div>
    <!-- ####### 01. HEADER END ####### -->
    <hr class="skip"/>
    <!-- ####### 02. LNB START ######### -->
    <div class="lnb_wrap">
        <!-- #### 02-1. 좌측 고정 업종별 아이콘 메뉴 시작 -->
        <dl class="fixed_quick_menu" th:include="fixed_lnb.html"></dl>
        <hr class="skip"/>
        <!-- #### 02-2. 좌측 on/off 페이지 서브 메뉴 노출 시작 -->
        <div class="lnb main" th:include="main_lnb.html">
            <div class="btn_lnb_open"><a href="#" class="fa fa-chevron-left"></a></div>
            <!-- 02-2-2.페이지 컨텐츠 서브 메뉴 노출 끝 -->
        </div>
        <!-- #### 02-2 좌측 on/off 페이지 서브 메뉴 노출 끝 -->
    </div>
    <!-- ####### 02. LNB END ########## -->
    <hr class="skip"/>
    <!-- ####### 03. CONTENTS START ####### -->
    <section class="contents_wrap">
        <!-- #### 03-1.우측 본문 영역 시작 -->
        <div class="right_contents">
            <!-- ######## 각 페이지에 해당 하는 내용 HTML을 넣어주세요.########### -->


            <div id="map"></div>
                <script>
                    var mapContainer = document.getElementById('map'), // 지도를 표시할 div
                        mapOption = {
                            center: new kakao.maps.LatLng(36.01683146793617, 129.42603381793853), // 지도의 중심좌표
                            level: 13 // 지도의 확대 레벨
                        };
                    // 지도를 생성합니다
                    var map = new kakao.maps.Map(mapContainer, mapOption);

                    // 지도에 추가된 지도타입정보를 가지고 있을 변수입니다
                    var currentTypeId;

                    // 버튼이 클릭되면 호출되는 함수입니다
                    function setOverlayMapTypeId(maptype) {
                        // 현재 지도 타입이 교통정보인지 확인합니다
                        var isTrafficType = currentTypeId === kakao.maps.MapTypeId.TRAFFIC;

                        if (maptype === 'traffic') {
                            // 현재 지도 타입이 교통정보이면 껐다 켭니다
                            if (isTrafficType) {
                                map.removeOverlayMapTypeId(kakao.maps.MapTypeId.TRAFFIC);
                                currentTypeId = null;
                            } else {
                                // 교통정보 지도타입을 추가합니다
                                map.addOverlayMapTypeId(kakao.maps.MapTypeId.TRAFFIC);
                                currentTypeId = kakao.maps.MapTypeId.TRAFFIC;
                            }
                        }
                    }

                    // // 지도에 교통정보를 표시하도록 지도타입을 추가합니다
                    // map.addOverlayMapTypeId(kakao.maps.MapTypeId.TRAFFIC);

                    // 일반 지도와 스카이뷰로 지도 타입을 전환할 수 있는 지도타입 컨트롤을 생성합니다
                    var mapTypeControl = new kakao.maps.MapTypeControl();

                    // 지도에 컨트롤을 추가해야 지도위에 표시됩니다
                    // kakao.maps.ControlPosition은 컨트롤이 표시될 위치를 정의하는데 TOPRIGHT는 오른쪽 위를 의미합니다
                    map.addControl(mapTypeControl, kakao.maps.ControlPosition.TOPRIGHT);

                    // 지도 확대 축소를 제어할 수 있는  줌 컨트롤을 생성합니다
                    var zoomControl = new kakao.maps.ZoomControl();
                    map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);

                    // 주소-좌표 변환 객체를 생성합니다
                    var geocoder = new kakao.maps.services.Geocoder();

                    $(document).ready(function() {
                        // 웹소켓 연결
                        var socket = new WebSocket("ws://localhost:8060/");
                        // 웹소켓 연결 성공 시 이벤트 핸들러
                        socket.onopen = function(event) {
                            console.log("WebSocket connected.");
                        };
                        // 웹소켓으로부터 데이터 수신 시 이벤트 핸들러
                        socket.onmessage = function(event) {
                            var receivedData = event.data;
                            console.log("Received data: " + receivedData);
                            new_marker(receivedData)
                        };

                        // 웹소켓 연결 종료 시 이벤트 핸들러
                        socket.onclose = function(event) {
                            console.log("WebSocket disconnected.");
                        };
                    });

                    function new_marker(received_data) {

                        var nomal_info = JSON.parse(received_data);
                        console.log("json:" + nomal_info)

                        var infoArray = Array.isArray(nomal_info) ? nomal_info : [nomal_info];

                        infoArray.forEach(function (address) {

                            var first_address = address['소재지주소']
                            var second_address = address['소새지상세주소']

                            // 주소로 좌표를 검색합니다
                            geocoder.addressSearch(first_address + second_address, function (result, status) {

                                // 정상적으로 검색이 완료됐으면
                                if (status === kakao.maps.services.Status.OK) {

                                    var coords = new kakao.maps.LatLng(result[0].y, result[0].x);

                                    // 결과값으로 받은 위치를 마커로 표시합니다
                                    var marker = new kakao.maps.Marker({
                                        map: map,
                                        position: coords
                                    });
                                }
                            });
                        });
                    }

                    // // 인포윈도우로 장소에 대한 설명을 표시합니다
                    // var infowindow = new kakao.maps.InfoWindow({
                    //     content: '<div style="width:150px;text-align:center;padding:6px 0;">우리회사</div>'
                    // });
                    // infowindow.open(map, marker);
                    //
                    // 지도의 중심을 결과값으로 받은 위치로 이동시킵니다
                    // map.setCenter(coords);

                </script>


            <!-- ######## 각 페이지에 해당 하는 내용 HTML을 넣어주세요.########### -->
        </div>
        <!-- #### 03-1.우측 본문 영역 끝 -->
    </section>
    <!-- ####### 03. CONTENTS END ####### -->
    <hr class="skip"/>
    <!-- ####### 04. FOOTER START ####### -->
    <div class="footer_wrap" th:include="footer.html"></div>
    <!-- ####### 04. FOOTER END ####### -->

</div>
</body>
</html>